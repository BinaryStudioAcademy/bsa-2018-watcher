<app-conversation-panel [onDisplay]="onDisplayChat" (close)="selectedChat=null" (collapse)="onCollapseChat($event)"></app-conversation-panel>
<app-chat-create-popup [onDisplay]="onDisplayCreating"></app-chat-create-popup>

<div class="chat-list-panel ui-shadow">
  <p-accordion expandIcon="" collapseIcon="">
    <p-accordionTab>
      <p-header class="vertical-center">
        <div>
          <div class="panel-name">
            <span *ngIf="totalUnreadMessages" class="message-counter">{{totalUnreadMessages}}</span>
            Chats
          </div>
        </div>
        <i class="icon icon-right fa fa-plus" (click)="openCreating($event)" pTooltip="Create" tooltipPosition="top"></i>
      </p-header>
      <div class="text-center spinner" *ngIf="isLoading">
          <p-progressSpinner [style]="{width: '50px', height: '50px'}" strokeWidth="3"></p-progressSpinner>
      </div>
      <p-listbox [options]="chatList" *ngIf="!isLoading" [(ngModel)]="selectedChat" (onChange)="selectChat()">
        <ng-template let-chat pTemplate="item">
          <div class="ui-fluid ui-g">
            <div class="ui-g-3 ui-g-nopad" style="position:relative">
              <img class="chat-list-img" src="{{getChatImage(chat?.value)}}" />
              <span *ngIf="chat.value.unreadMessagesCount !== 0" class="message-counter counter-absolute">
                {{chat.value.unreadMessagesCount}}
              </span>
            </div>
            <div class="ui-g-9 ui-g-nopad">
              <span class="chat-list-name text-overflow">{{chat.value.name}}</span>
            </div>
          </div>
        </ng-template>
      </p-listbox>
    </p-accordionTab>
  </p-accordion>
</div>
